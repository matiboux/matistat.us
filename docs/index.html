<html>
<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="author" content="Matiboux" />
<meta name="theme-color" content="#303030" />
<link rel="icon" sizes="64x64" href="favicon.png" />
<link rel="icon" sizes="192x192" href="favicon-192.png" />

<link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous" />
<link rel="stylesheet" type="text/css" href="style.css" />
<title>Matiboux › Status</title>

</head>
<body>

<header id="header">
	<div class="title">
		<h1>Matiboux Status</h1>
		<p>Is it down though?™</p>
	</div>
	<div class="infos">
		<p class="timer"><span>>_</span> Loading...</p>
		<p>
			<abbr title="API Status"><i class="status status-api"></i></abbr>
			<span class="status-notice status-api">Loading...</span>
		</p>
	</div>
</header>

<div id="main">
	<!--<ul class="settings">
		<li id="toggleDns" class="toggled"><i class="fas fa-globe fa-fw"></i> Domains View</li>
		<li id="toggleHttp"><i class="fas fa-project-diagram fa-fw"></i> Projects View</li>
	</ul>-->
	<article type="domain" hook="matistat.us" src="https://matistat.us/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>Matistat.us</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Status for my projects and.. you're right here! <i class="fas fa-heart fa-fw" style="color: #c04040"></i></p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
	<article type="domain" hook="matiboux.com" src="https://matiboux.com/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>Matiboux.com</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">My very own website! Nothing serious but few projects hosted there.</p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
	<article type="domain" hook="imgshot.eu" src="https://imgshot.eu/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>ImgShot.eu</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Open source and free image hosting service.</p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
	<article type="domain" hook="ljv.fr" src="https://ljv.fr/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>Ljv.fr</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">A set of unofficial high school projects.</p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
	<article type="domain" hook="olifw.net" src="https://olifw.net/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>Olifw.net</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">Showcase and documentation for Oli, my own open-source PHP framework.</p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
	<article type="domain" hook="urwebs.it" src="https://urwebs.it/">
		<header>
			<abbr title="Local Status"><i class="status status-local"></i></abbr>
			<abbr title="Online Status"><i class="status status-online"></i></abbr>
			<span>Domain</span>
			<h2>Urwebs.it</h2>
			<a href="#"><i class="fas fa-globe"></i></a>
		</header>
		<p class="description">A cool domain name for web-related stuff hosting.</p>
		<p class="status-notice status-local">Loading...</p>
		<p class="status-notice status-online">Loading...</p>
	</article>
</div>

<footer id="footer">
	<section>
		<ul>
			<li><i class="fab fa-github fa-fw"></i> <a href="https://github.com/matiboux/matistat.us">Open-Source Repository</a> (Website & API)</li>
			<li><i class="fas fa-wifi fa-fw"></i> <a href="https://status.matiboux.com/">Matiboux Status API</a></li>
			<li><i class="fas fa-globe fa-fw"></i> Check out <a href="https://matiboux.com/">my website</a></li>
		</ul>
	</section>
	<section>Built with nothing but love. <i class="fas fa-heart fa-fw" style="color: #c04040"></i></section>
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script>
(function() {

/*$('#toggleArchives').click(function() {
	if($(this).hasClass('toggled')) $('#main .projects .item.archive').fadeOut();
	else $('#main .projects .item.archive').fadeIn();
	$(this).toggleClass('toggled');
});
$('#toggleForks').click(function() {
	if($(this).hasClass('toggled')) $('#main .projects .item.fork').fadeOut();
	else $('#main .projects .item.fork').fadeIn();
	$(this).toggleClass('toggled');
});*/

$('#main > article').on('click', 'header > a[href="#"]', function(e) { e.preventDefault(); });

var timer = 0;
var apiNotice = true;
var refresh = function() {
	if(timer > 0) {
		timer = timer - 1;
	} else {
		timer = 60;
		
		/** Online Status */
		$('#header .status.status-api').removeClass().addClass('status status-api status-warning');
		$('#header .status-notice.status-api').html('Checking status..');
		$('article .status-notice.status-online').html('Checking status..');
		$.ajax({
			url: 'https://status.matiboux.com/',
			type: 'GET',
			dataType: 'json'
		}).then(function(data, textStatus, xhr) {
			//console.log(data, textStatus, xhr);
			if(!apiNotice) {
				$('article .status-notice.status-local').hide();
				$('article .status-notice.status-online').fadeIn();
				apiNotice = true;
			}
			
			$('#header .status.status-api').removeClass().addClass('status status-api status-success');
			$('#header .status-notice.status-api').html('API Service OK');
			
			$.each(data.statuses, function(index, value) {
				var $this = $('article[hook="' + index + '"]');
				
				/** Request error */
				if(!value.success) {
					$this.find('.status.status-online').removeClass().addClass('status status-online status-danger')
						.parent().attr({title: 'Online Status: Request error.', http: value.http_code});
					$this.find('.status-notice.status-online').html('Request error. (HTTP ' + value.http_code + ')');
				
				/** HTTP 2xx - Service OK */
				} else if(value.http_code >= 200 && value.http_code < 300) {
					$this.find('.status.status-online').removeClass().addClass('status status-online status-success')
						.parent().attr({title: 'Online Status: Service OK!', http: value.http_code});
					$this.find('.status-notice.status-online').html('Service OK! (HTTP ' + value.http_code + ')');
				
				/** HTTP 3xx, 4xx - Service Unavailable */
				} else if(value.http_code >= 300 && value.http_code < 500) {
					$this.find('.status.status-online').removeClass().addClass('status status-online status-warning')
						.parent().attr({title: 'Online Status: Service Unavailable.', http: value.http_code});
					$this.find('.status-notice.status-online').html('Service Unavailable. (HTTP ' + value.http_code + ')');
				
				/** Service Down */
				} else {
					$this.find('.status.status-online').removeClass().addClass('status status-online status-danger')
						.parent().attr({title: 'Online Status: Service Down.', http: value.http_code});
					$this.find('.status-notice.status-online').html('Service Down. (HTTP ' + value.http_code + ')');
				}
			});
		}, function(xhr, textStatus, errorThrown) {
			//console.log(xhr, textStatus, errorThrown);
			if(apiNotice) {
				$('article .status-notice.status-online').hide();
				$('article .status-notice.status-local').fadeIn();
				apiNotice = false;
			}
			
			$('#header .status.status-api').removeClass().addClass('status status-api status-danger');
			$('#header .status-notice.status-api').html('API Service Down.');
		});
		
		/** Local Status */
		$('#main > article').each(function() {
			var $this = $(this);
			var url = $this.attr('src');
			$this.find('header > a').attr('href', url)
			
			$('article .status-notice.status-local').html('Checking status..');
			
			$.ajax({
				url: url,
				type: 'GET',
				dataType: 'jsonp'
			}).then(function(data, textStatus, xhr) {
				//console.log('DONE', url, '/', data, '...', textStatus, '...', xhr);
				
				/** Everything is fine. */
				$this.find('.status.status-local').removeClass().addClass('status status-local status-primary')
					.parent().attr({title: 'Local Status: Service is fine!', http: xhr.status});
				$this.find('.status-notice.status-local').html('Service is fine! (HTTP ' + xhr.status + ')');
			}, function(xhr, textStatus, errorThrown) {
				//console.log('FAIL', url, ':', xhr, textStatus, errorThrown);
				
				/** XHR query interrupted */
				if(xhr.status === 0) {
					$this.find('.status.status-local').removeClass().addClass('status status-local status-danger')
						.parent().attr({title: 'Local Status: Request interrupted.', http: xhr.status});
					$this.find('.status-notice.status-local').html('Request Interrupted. (HTTP ' + xhr.status + ')');
				
				/** HTTP 2xx - Service OK */
				} else if(xhr.status >= 200 && xhr.status < 300) {
					$this.find('.status.status-local').removeClass().addClass('status status-local status-primary')
						.parent().attr({title: 'Local Status: Seems OK!', http: xhr.status});
					$this.find('.status-notice.status-local').html('Service seems OK! (HTTP ' + xhr.status + ')');
				
				/** 404 Not Found */
				} else if(xhr.status == 404) {
					$this.find('.status.status-local').removeClass().addClass('status status-local status-warning')
						.parent().attr({title: 'Local Status: Okay, but not found.', http: xhr.status}); 
					$this.find('.status-notice.status-local').html('Page not found. (HTTP ' + xhr.status + ')');
				
				/** 500 Internal server error */
				} else if(xhr.status == 500) {
					$this.find('.status.status-local').removeClass().addClass('status status-local status-danger')
						.parent().attr({title: 'Local Status: Internal server error.', http: xhr.status}); 
					$this.find('.status-notice.status-local').html('Internal server error. (HTTP ' + xhr.status + ')');
				
				} else {
					$this.find('.status.status-local').removeClass().addClass('status status-local status-danger')
						.parent().attr({title: 'Local Status: Error!', http: xhr.status});
					$this.find('.status-notice.status-local').html('Error! (HTTP ' + xhr.status + ')');
				}
				
				if(exception === 'parsererror') console.log(url, 'Impossible to parse result.');
				else if(exception === 'timeout') console.log(url, 'Request timeout.');
				else console.log(url, 'Error!');
				
				$this.find('.status.status-local').removeClass().addClass('status status-local status-danger');
				$this.find('.status-notice.status-local').html('Service seems down :/');
			});
		});
	}
	
	$('#header .timer').empty().append(
		'Refreshing in', $('<br>'),
		$('<span>').html(timer), ' seconds..'
	);
	setTimeout(refresh, 1000);
}
refresh(); // Start

})();

</script>

</body>
</html>